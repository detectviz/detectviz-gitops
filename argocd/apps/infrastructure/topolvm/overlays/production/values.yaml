# 說明: 覆寫 TopoLVM Helm Chart 的值
# 1. 根據 README.md 架構，將 controller 和 node 都部署到 app-worker 節點。
# 2. 包含 中為 LVM/儲存管理設定的特權模式。

# --- 1. Controller (Deployment) 調度 ---
controller:
  # 部署到 app-worker 節點
  nodeSelector:
    node-role.kubernetes.io/workload-apps: "true"
  # (Tolerations 由 controller-tolerations.yaml 處理)

# --- 2. Node (DaemonSet) 調度與權限 ---
node:
  # 關鍵：由於儲存 (LVM) 只在 app-worker (VM-4) 上，
  # Node DaemonSet 也必須只在該節點上運行。
  nodeSelector:
    node-role.kubernetes.io/workload-apps: "true"

  # (來自你現有 values.yaml 的特權設定)
  # 需要特權模式來管理本地儲存
  securityContext:
    privileged: true

# --- 3. LVMD (LVM Daemon) 設定 ---
lvmd:
  managed: true
  socketName: /run/topolvm/lvmd.sock

  # Device Classes 配置 (對應 app-worker 的 topolvm-vg)
  deviceClasses:
    - name: ssd
      volume-group: topolvm-vg  # 必須與 app-worker 上建立的 VG 名稱一致
      default: true
      spare-gb: 10              # 保留 10GB 空間避免 VG 滿載

  # 需要特權模式來管理 LVM
  securityContext:
    privileged: true

# --- 4. Scheduler 配置 ---
# 使用 StorageCapacity Tracking 而非 Scheduler Extender
scheduler:
  enabled: false  # 禁用 scheduler extender (DaemonSet)

# --- 5. Controller 配置 ---
controller:
  storageCapacityTracking:
    enabled: true  # 啟用 CSI Storage Capacity Tracking (Kubernetes 1.21+)

# --- 6. Webhook 配置 ---
webhook:
  podMutatingWebhook:
    enabled: false  # StorageCapacity 模式不需要 pod mutating webhook

# --- 7. CertManager (來自你現有 values.yaml) ---
certManager:
  enabled: true
