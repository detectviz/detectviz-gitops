apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  # 進階資源 (依賴基礎設施 CRDs)
  - argocd-ingress.yaml       # 需要 Ingress Controller
  - cluster-issuer.yaml        # 需要 cert-manager
  - rollouts-extension.yaml    # 需要 ArgoCD Rollouts

# 通用標籤
labels:
  - pairs:
      app.kubernetes.io/managed-by: kustomize
      bootstrap.phase: "2-advanced"

# Sync Wave: 10 (在基礎設施部署之後)
# 注意: 這些資源需要等待基礎設施 ApplicationSets 先部署相關組件
commonAnnotations:
  argocd.argoproj.io/sync-wave: "10"
  # 跳過 dry-run,避免因 CRD 不存在而失敗
  argocd.argoproj.io/sync-options: "SkipDryRunOnMissingResource=true"
